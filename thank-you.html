<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thank You | MagnaMoney</title>

  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --charcoal: #1C1C1C;
      --charcoal-panel: rgba(29,30,32,0.95);
      --panel-border: rgba(255,255,255,0.07);
      --text-main: #FFFFFF;
      --text-dim: rgba(255,255,255,0.8);
      --text-faint: rgba(255,255,255,0.6);
      --gold: #C6A76B;
      --gold-shadow: rgba(198,167,107,0.3);
      --max-width: 900px;
      --radius-lg: 12px;
    }

    * { box-sizing:border-box; }

    body {
      margin:0;
      background:var(--charcoal);
      font-family:"Lato", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:var(--text-main);
      padding:24px;
      display:flex;
      justify-content:center;
    }

    .page-wrap { width:100%; max-width:var(--max-width); }
    .panel {
      background:linear-gradient(180deg, rgba(29,30,32,0.95), rgba(29,30,32,0.9));
      border-radius:var(--radius-lg);
      border:1px solid var(--panel-border);
      box-shadow:0 16px 40px rgba(0,0,0,0.6);
      padding:32px 24px 32px;
      text-align:center;
    }

    .logo-wrap { display:inline-flex; flex-direction:column; align-items:center; justify-content:center; margin-bottom:16px; }
    .crown-logo { width:72px; height:72px; background-size:contain; background-repeat:no-repeat; background-position:center; background-image:url("https://magna-money-enquiry-form.neocities.org/Magna%20Money%20logo_full_colour.png"); filter:drop-shadow(0 4px 12px var(--gold-shadow)); }
    .brand-name { color:var(--text-main); font-weight:700; font-size:18px; line-height:1.2; letter-spacing:0.05em; margin-top:12px; text-transform:uppercase; }
    .brand-tag { color:var(--gold); font-size:13px; font-weight:400; margin-top:6px; text-align:center; max-width:540px; }

    .thanks-headline { font-size:20px; font-weight:700; color:var(--gold); line-height:1.3; margin:24px 0 12px; }
    .thanks-body { color:var(--text-dim); font-size:15px; font-weight:300; line-height:1.5; max-width:620px; margin:0 auto 18px; }

    .progress-wrap { max-width:440px; margin:18px auto 10px; text-align:left; }
    .progress-bar { width:100%; height:12px; background: rgba(255,255,255,0.06); border-radius:8px; overflow:hidden; border:1px solid rgba(255,255,255,0.04); }
    .progress-fill { height:100%; width:0%; background: linear-gradient(90deg, var(--gold), rgba(198,167,107,0.85)); box-shadow:0 6px 18px rgba(198,167,107,0.08); transition:width 0.2s linear; }

    .countdown { color:var(--text-dim); font-size:13px; margin-top:8px; text-align:center; }

    .contact-block { margin-top:16px; font-size:14px; line-height:1.5; color:var(--text-main); font-weight:400; }
    .footer-line { margin-top:24px; font-size:13px; line-height:1.4; color:var(--text-faint); }

    .user-info { margin-top:12px; color:var(--text-dim); font-size:14px; }
    .manual-link { margin-top:14px; display:inline-block; background:var(--gold); color:var(--charcoal); padding:10px 14px; border-radius:8px; font-weight:700; text-decoration:none; }

    @media (max-width:640px){ .thanks-headline{ font-size:18px; } .thanks-body{ font-size:14px; } }
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="panel">
      <div class="logo-wrap">
        <div class="crown-logo" aria-hidden="true"></div>
        <div class="brand-name">MAGNAMONEY</div>
        <div class="brand-tag">The Commercial Finance Boutique – Bespoke, Collaborative &amp; Expert Funding Advisory</div>
      </div>

      <div class="thanks-headline">Thank you — we've received your information</div>

      <div class="thanks-body">
        Your details have been submitted securely. I’ll review everything and come back to you quickly with next steps.
      </div>

      <div id="userInfo" class="user-info" aria-live="polite"></div>

      <div class="progress-wrap">
        <div class="progress-bar" aria-hidden="true"><div id="progressFill" class="progress-fill"></div></div>
        <div id="countdownText" class="countdown">Redirecting to book a time in <strong id="countNum">8</strong> seconds…</div>
      </div>

      <div class="contact-block">
        <div><strong>Questions right now?</strong></div>
        <div>Speak directly with Andrew Crutchley</div>
        <div>07377&nbsp;018&nbsp;238</div>
        <div>andrew.crutchley@magnamoney.co.uk</div>
        <div>www.magnamoney.co.uk</div>
      </div>

      <a id="manualLink" class="manual-link" href="#" role="button" style="display:none;">Go to booking now</a>

      <div class="footer-line">Magna Money is a trading style of Sedulo Funding Solutions Ltd (10276541).</div>
    </div>
  </div>

  <script>
    // CONFIG: set these to match your Apps Script + HubSpot meeting base
    const SCRIPT_EXEC_URL = 'https://script.google.com/macros/s/AKfycby8Zv4WLTcElTcQjKHVcVORIQ8m5t5-5OXpJkxMuA0O6E8DCAV2iQIbqwHF6OwfvpFB/exec';
    const HUBSPOT_MEETINGS_BASE = 'https://meetings.hubspot.com/andrew-crutchley';

    function qs(name, url){
      if(!url) url = window.location.href;
      name = name.replace(/[\[\]]/g, "\\$&");
      const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
      const results = regex.exec(url);
      if(!results) return null;
      if(!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    // parse querystring from an arbitrary URL -> object
    function parseQS(url){
      const q = {};
      const idx = url.indexOf('?');
      if(idx === -1) return q;
      const parts = url.substring(idx+1).split('&');
      parts.forEach(p=>{
        const kv = p.split('=');
        if(kv[0]) q[decodeURIComponent(kv[0])] = decodeURIComponent((kv[1]||''));
      });
      return q;
    }

    (function(){
      const sid = qs('sid');
      const fill = document.getElementById('progressFill');
      const countNum = document.getElementById('countNum');
      const countdownText = document.getElementById('countdownText');
      const userInfo = document.getElementById('userInfo');
      const manualLink = document.getElementById('manualLink');

      let total = 8;
      let remaining = total;

      function finalRedirect(target){
        // attempt top-level redirect
        try { window.top.location.href = target; return; } catch(e){}
        try { window.parent.location.href = target; return; } catch(e){}
        window.location.href = target;
      }

      function startCountdown(targetUrl){
        manualLink.href = targetUrl;
        manualLink.style.display = 'inline-block';
        const tick = ()=>{
          const pct = Math.round(((total - remaining) / total) * 100);
          fill.style.width = pct + '%';
          countNum.textContent = remaining;
          countdownText.textContent = 'Redirecting to book a time in ' + remaining + (remaining===1 ? ' second…' : ' seconds…');
          if(remaining <= 0){
            fill.style.width = '100%';
            finalRedirect(targetUrl);
            return;
          }
          remaining--;
          setTimeout(tick, 1000);
        };
        tick();
      }

      if(!sid){
        // no sid — fallback to hubspot base after short pause
        userInfo.textContent = '';
        startCountdown(HUBSPOT_MEETINGS_BASE);
        return;
      }

      // fetch prefill mapping from Apps Script
      fetch(SCRIPT_EXEC_URL + '?sid=' + encodeURIComponent(sid)).then(resp=>{
        if(!resp.ok) throw new Error('Network response not OK: ' + resp.status);
        return resp.json();
      }).then(data=>{
        let target = (data && data.prefillUrl) ? data.prefillUrl : HUBSPOT_MEETINGS_BASE;
        // try to extract name/email from prefillUrl and show to user
        try {
          const qi = parseQS(target || '');
          const pieces = [];
          if(qi.firstname) pieces.push('First name: ' + qi.firstname);
          if(qi.lastname) pieces.push('Last name: ' + qi.lastname);
          if(qi.email) pieces.push('Email: ' + qi.email);
          if(pieces.length) userInfo.innerHTML = pieces.join('<br>');
        } catch(e){}
        startCountdown(target);
      }).catch(err=>{
        console.warn('Could not fetch prefill mapping; falling back to meetings base', err);
        startCountdown(HUBSPOT_MEETINGS_BASE);
      });

      // allow click anywhere to go now
      document.body.addEventListener('click', ()=> {
        // if manualLink has a URL, go there now
        if(manualLink && manualLink.href && manualLink.href !== '#') finalRedirect(manualLink.href);
      });
    })();
  </script>
</body>
</html>
